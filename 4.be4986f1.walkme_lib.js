window,window._walkmeWebpackJP&&(window._walkmeWebpackJP=window._walkmeWebpackJP||[]).push([[4],{388:function(t,i,s){"use strict";s.r(i),s.d(i,"AttentionGrabberDataManager",function(){return n});var i=s(143),h=s(22),n=(r.prototype.updateSelection=function(t){this.selectedId=t,this.t()},r.prototype.updateEvent=function(){this.o=(new Date).getTime(),this.t()},r.prototype.updateUnload=function(){this.unload=1,this.t()},r.prototype.init=function(){var t,i,s=this.A.getData(this.M),h=(new Date).getTime(),n=this.G.get().Settings,r=parseInt(n.AGDataVersion)||0;s?(this.C=h,this.sessionCounter=s.sc||1,this.D=this.p.isDefined(s.v)?s.v:r,this.S=r>this.D,t=s.st?Math.abs(h-s.st):0,i=void 0,this.O&&(i=this.O.getItem(this.A.keysConfig.attentionGrabber.sessionLength.key)),this.I=parseFloat(i||n.AGSL||1440),this.U=t/6e4>this.I,this.isNewSession=this.U||this.S,this.sessionCounter=this.S?1:this.U?this.sessionCounter+1:this.sessionCounter,this.D=this.S?r:s.v,this.selectedId=this.isNewSession?void 0:s.id,this.o=this.isNewSession?h:s.et,this.unload=this.isNewSession?0:s.u,this.eventTimestampDelta=this.o?Math.abs(h-this.o):0):(this.isNewSession=!0,this.C=h,this.sessionCounter=1,this.D=r,this.o=h,this.unload=0),this.F=!0,this.t()},r.prototype.t=function(){var t;this.F&&(t={st:this.C,sc:this.sessionCounter,v:this.D,id:this.selectedId,et:this.o,u:this.unload},this.A.saveData(this.M,t,this.A.keysConfig.attentionGrabber.data.expiry))},r);function r(t,i,s){this.O=Object(h.get)(),this.F=!1,this.G=t,this.A=i,this.p=s,this.M=i.keysConfig.attentionGrabber.data.key}i.register("AttentionGrabberDataManager").asCtor(n).dependencies("SiteConfigManager, ClientOrServerStorageManager, CommonUtils")},389:function(t,i,h){"use strict";h.r(i),h.d(i,"AttentionGrabberManager",function(){return s});var n=h(0),r=h(143),s=(e.prototype.init=function(t){var i,s;t.config&&t.player&&(this.L=t.config,this.P=t.player,this.T=t.menu,i=this.L.Settings.AG,(s=this.L.Settings.AGs)&&0<s.length?(this.q.init(),this.B(s)):i&&this.create(t).setupAttenGrab())},e.prototype.reset=function(){this.H=this.J=this.L=this.P=this.T=void 0},e.prototype.blockLoad=function(){this.K=!0},e.prototype.B=function(t){this.q.isNewSession?(i=(i=this.N(t)).sort(function(t,i){return t.Priority-i.Priority}),this.R(i)):this.V(t),this.H?(this.W.customerLog("Attention grabber - name: "+this.H.Name+", settings:",3),this.W.customerLog(this.H.Settings,3)):this.W.customerLog("Attention grabber: not selected",3);var i="Attention grabber data: session counter = "+this.q.sessionCounter+", selected AG = "+this.q.selectedId+", unload AG = "+this.q.unload+", event timestamp delta = "+this.q.eventTimestampDelta/1e3+"s, session = "+this.q.isNewSession;this.W.customerLog(i,4)},e.prototype.N=function(t){for(var i=[],s=this.q.sessionCounter,h=0;h<t.length;h++){var n=t[h],r=n.Settings;this.X(s,r)&&(parseInt(r.newContent)?this.Y.hasNewDeployables()&&(n.Priority-=this.Z,i.push(n)):i.push(n))}return i},e.prototype.R=function(t){for(var i=0;i<t.length;i++){var s=t[i],h=s.Settings;if(!h.conditions)return this.H=s,void this.q.updateSelection(s.Id);if(this.$.evaluate(h.conditions))return this.H=s,void this.q.updateSelection(s.Id)}},e.prototype.V=function(t){for(var i=this.q.sessionCounter,s=0;s<t.length;s++){var h,n=t[s];n.Settings;if(n.Id==this.q.selectedId)return h=n.Settings,void(this.X(i,h)&&this._(h)&&(!h.conditions||this.$.evaluate(h.conditions)?(this.H=n,this.q.updateSelection(n.Id)):this.W.customerLog("Attention grabber conditions are not satisfied",5)))}},e.prototype.X=function(t,i){return!(!(i&&this.tt.isDefined(i.session)&&this.tt.isDefined(i.interval))||t<i.session||t!=i.session&&(0==i.interval||(t-i.session)%i.interval!=0))},e.prototype._=function(t){if(this.q.unload)return!1;if(!t)return!1;var i=this.q.eventTimestampDelta,s=parseInt(t.replay);if(!s||!i)return!1;s=60*s*1e3;return t.delay=s<i?0:(s-i)/1e3,!0},e.prototype.load=function(s){return Object(n.__awaiter)(this,void 0,void 0,function(){var i;return Object(n.__generator)(this,function(t){switch(t.label){case 0:return!this.H||this.K?[2]:(i={config:this.L,player:this.P,menu:this.T,agData:this.H},[4,h.e(3).then(h.bind(null,1144))]);case 1:return t.sent(),this.J=r.create("AttentionGrabber",i),this.J.setupAttenGrab(),s&&s(),[2]}})})},e.prototype.remove=function(t){this.J?(this.q.updateUnload(),this.J.remove(t)):t&&t()},e.prototype.create=function(t){return this.L=t.config,this.P=t.player,this.J=r.create("AttentionGrabber",t),this.J},e.prototype.getImageAG=function(t){return this.L=t.config,this.P=t.player,this.J=r.create("ImageAttentionGrabber",t),this.J},e);function e(t,i,s,h,n,r){this.tt=r,this.K=!1,this.Z=1e3,this.$=t,this.A=s,this.Y=h,this.W=n,this.q=i}r.register("AttentionGrabberManager").asCtor(s).dependencies("ConditionTreeEvaluator, AttentionGrabberDataManager, ClientOrServerStorageManager, PublishDataManager, Logger, CommonUtils, SiteConfigManager, Consts")}}]);